<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://jakarta.ee/tags/c" %>
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista de Producto - Ecommerce</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="estilos/styles_productos.css">

</head>

<body>

    <header>
        <div class="logo">
            <a href="index.html">
                <img src="https://soendergaard.com/wp-content/uploads/2024/06/logoipsum-logo-29-1.png" alt="Logo">
            </a>
        </div>

        <nav class="nav_items">
            <a href="">Item 1</a>
            <a href="">Item 2</a>
            <a href="">Item 3</a>
        </nav>

        <div class="search_container">
            <input type="text" placeholder="">
            <i data-lucide="search" style="width: 18px; color: var(--color-txt-secondary);"></i>
        </div>

        <div class="user_section">
            <c:choose>
                <c:when test="${not empty sessionScope.usuarioLogueado}">
                    <span style="color: white; margin-right: 10px;">Hola, ${sessionScope.usuarioLogueado.nombre}</span>
                    <a href="logout" style="color: #ccc; font-size: 14px;">(Salir)</a>
                </c:when>
                <c:otherwise>
                    <a class="login_btn" href="login.html">Iniciar Sesión</a>
                </c:otherwise>
            </c:choose>
            <img class="user_avatar" src="https://cdn-icons-png.flaticon.com/512/12225/12225881.png" alt="Avatar">
        </div>
    </header>

    <div class="contenedor">
        <div class="categorias">
            <h3 id="titulo_categorias">Categorías</h3>
            <a class="categorias_disponibles" href="">Audífonos</a>
            <a class="categorias_disponibles" href="">Monitores</a>
            <a class="categorias_disponibles" href="">Teclados</a>
            <a class="categorias_disponibles" href="">Ratones</a>
            <a class="categorias_disponibles" href="">Sillas</a>
        </div>

        <div class="product_view_container">
            
            <div class="product_gallery">
                <div class="main_image_container">
                    <img src="https://ddtech.mx/assets/uploads/f85223743453736762382415170425c8.jpg" alt="MSI Laptop" class="main_image">
                </div>
                
                <div class="thumbnail_slider">
                    <div class="nav_arrow">«</div>
                    <div class="thumbnail active">
                        <img src="https://ddtech.mx/assets/uploads/f85223743453736762382415170425c8.jpg" alt="Thumb 1">
                    </div>
                    <div class="thumbnail">
                        <img src="https://ddtech.mx/assets/uploads/e4501a91e5c00e70a316279f3237a85e.jpg" alt="Thumb 2">
                    </div>
                    <div class="thumbnail">
                        <img src="https://ddtech.mx/assets/uploads/74e899216124e414c4c23c14a275f469.jpg" alt="Thumb 3">
                    </div>
                    <div class="nav_arrow">»</div>
                </div>
            </div>

            <div class="product_details">
                <h1 class="product_title">Laptop MSI VECTOR 16 HX AI A2XWIG-400US</h1>
                <div class="availability">Disponible</div>
                <p class="product_description">
                    Laptop MSI VECTOR 16 HX AI A2XWIG-400US / Intel Ultra 9-275HX / 16G de Ram / RTX 4060.
                    Alto rendimiento para gaming y tareas profesionales con la última tecnología de IA.
                </p>
                <hr class="divider">
                <div class="product_price">$13,500</div>
                <div class="tax_info">+IVA</div>
                <hr class="divider">
                <div class="purchase_controls">
                    <div class="qty_selector">
                        <span>Cantidad:</span>
                        <input type="number" class="qty_input" value="2" min="1">
                    </div>
                    <button class="add_to_cart_btn">
                        Agregar al carrito
                        <i data-lucide="shopping-cart" style="width: 18px;"></i>
                    </button>
                    <a href="#reseñas" class="reviews_link">Reseñas</a>
                </div>
            </div>

            <div id="reseñas" class="reviews_section_container">
                <h2 class="reviews_header">Opiniones de clientes</h2>
                <hr class="reviews_divider">

                <div class="reviews_top_area">
                    <div class="ratings_summary">
                        <div class="rating_row">
                            <span class="rating_label">5</span>
                            <i data-lucide="star" style="width: 12px; margin-left:2px;"></i>
                            <div class="progress_bar_bg">
                                <div class="progress_bar_fill" style="width: 100%;"></div>
                            </div>
                            <span class="rating_count">2</span>
                        </div>
                        </div>

                    <div class="leave_review_box">
                        <div class="leave_review_title">Deja tu opinion</div>
                        
                        <c:choose>
                            <c:when test="${not empty sessionScope.usuarioLogueado}">
                                <form action="resenias" method="POST">
                                    <input type="hidden" name="accion" value="agregar">
                                    
                                    <textarea name="comentario" class="review_input" required placeholder="Escribe tu reseña aquí..."></textarea>
                                    
                                    <div class="review_actions">
                                        <div class="rating_row" style="margin-bottom:0;">
                                            <label for="calif" style="margin-right: 5px; font-size: 12px; font-weight: bold;">Calificación:</label>
                                            <input type="number" id="calif" name="calificacion" min="1" max="5" value="5" style="width: 40px; border-radius: 4px; border: none; padding: 2px;">
                                        </div>

                                        <button type="submit" class="btn_submit_review">
                                            Enviar
                                            <i data-lucide="send" style="width: 12px;"></i>
                                        </button>
                                    </div>
                                </form>
                            </c:when>
                            <c:otherwise>
                                <p style="text-align: center; font-size: 14px;">
                                    <a href="login.html" style="text-decoration: underline; color: white;">Inicia sesión</a> para dejar una reseña.
                                </p>
                            </c:otherwise>
                        </c:choose>
                    </div>
                </div>

                <c:forEach var="resenia" items="${listaResenias}">
                    <div class="review_card">
                        <div class="reviewer_info">
                            <div class="reviewer_avatar">
                                <i data-lucide="user" style="color: black;"></i>
                            </div>
                            <div class="reviewer_name">Usuario</div> 
                            <div class="review_date">${resenia.fecha}</div>
                        </div>
                        <div class="review_content">
                            <div class="review_text">
                                ${resenia.comentario}
                            </div>
                            <div class="review_footer">
                                <div class="review_stars_display" style="-webkit-text-stroke: 1px orange;">
                                    <c:forEach begin="1" end="${resenia.calificacion}">
                                        <i data-lucide="star" style="width: 16px; fill: var(--color-star); color: var(--color-star);"></i>
                                    </c:forEach>
                                </div>
                                
                                <div class="review_interaction">
                                    
                                    <c:if test="${not empty sessionScope.usuarioLogueado}">
                                        
                                        <c:if test="${sessionScope.usuarioLogueado.rolUsuario == 'ADMIN' || sessionScope.usuarioLogueado.id == resenia.idUsuario}">
                                            
                                            <form action="resenias" method="POST" style="display:inline;">
                                                <input type="hidden" name="accion" value="eliminar">
                                                <input type="hidden" name="idResenia" value="${resenia.id}">
                                                
                                                <button type="submit" class="interaction_btn" style="border:none; background:none; color: #ff6b6b; cursor: pointer; display: flex; align-items: center; gap: 5px;" 
                                                        onclick="return confirm('¿Estás seguro de eliminar esta reseña?');">
                                                    <i data-lucide="trash-2" style="width: 16px;"></i> Eliminar
                                                </button>
                                            </form>

                                        </c:if>
                                    </c:if>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </c:forEach>
                
                <c:if test="${empty listaResenias}">
                    <p style="text-align: center; color: #ccc;">Aún no hay reseñas para este producto.</p>
                </c:if>

            </div>
            </div>
    </div>

    <div class="contenedor_inferior">
        <footer class="footer">
            <p>&copy; 2025 Ecommerce. Todos los derechos reservados.</p>
            <p>Hecho por Equipo #2</p>
        </footer>
    </div>

    <script>
        lucide.createIcons();
    </script>
</body>

</html>